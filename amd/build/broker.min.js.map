{"version":3,"sources":["../src/broker.js"],"names":["define","$","mdlcfg","str","rooms","datasource","bigbluebuttonbn","init","bbb","wwwroot","sesskey","joinRedirect","joinUrl","window","open","endMeeting","qs","meetingid","bigbluebuttonbnid","getJSON","url","done","error","data","status","location","reload","completionValidate","message","get_string","M","mod_bigbluebuttonbn","helpers","alertError"],"mappings":"AAwBAA,OAAM,8BAAC,CAAC,QAAD,CAAW,aAAX,CAA0B,UAA1B,CAAsC,2BAAtC,CAAD,CACF,SAAUC,CAAV,CAAaC,CAAb,CAAqBC,CAArB,CAA0BC,CAA1B,CAAiC,IAKzBC,CAAAA,CAAU,CAAG,IALY,CAMzBC,CAAe,CAAG,EANO,CAuD7B,MA/Ca,CAMTC,IAAI,CAAE,cAAUC,CAAV,CAAe,CACjBH,CAAU,CAAGH,CAAM,CAACO,OAAP,CAAiB,4CAAjB,CAAgEP,CAAM,CAACQ,OAAvE,CAAiF,GAA9F,CACAJ,CAAe,CAAGE,CACrB,CATQ,CAeTG,YAAY,CAAE,sBAAUC,CAAV,CAAmB,CAC7BC,MAAM,CAACC,IAAP,CAAYF,CAAZ,CACH,CAjBQ,CAmBTG,UAAU,CAAE,qBAAY,CACpB,GAAIC,CAAAA,CAAE,CAAG,yBAA2BV,CAAe,CAACW,SAApD,CACAD,CAAE,EAAI,oBAAsBV,CAAe,CAACY,iBAA5C,CACAjB,CAAC,CAACkB,OAAF,CAAU,CACNC,GAAG,CAAEf,CAAU,CAAGW,CADZ,CAAV,EAGKK,IAHL,CAGU,SAAUC,CAAV,CAAiB,CACnB,GAAIA,CAAK,CAACC,IAAN,CAAWC,MAAf,CAAuB,CACnBpB,CAAK,CAACW,UAAN,GACAU,QAAQ,CAACC,MAAT,EACH,CACJ,CARL,CASH,CA/BQ,CAiCTC,kBAAkB,CAAE,4BAAUX,CAAV,CAAc,CAC9Bf,CAAC,CAACkB,OAAF,CAAU,CACNC,GAAG,CAAE,KAAKf,UAAL,CAAkBW,CADjB,CAAV,EAGKK,IAHL,CAGU,SAAUC,CAAV,CAAiB,CACnB,GAAIA,CAAK,CAACC,IAAN,CAAWC,MAAf,CAAuB,CACnB,GAAII,CAAAA,CAAO,CAAGzB,CAAG,CAAC0B,UAAJ,CAAe,kCAAf,CAAmD,iBAAnD,CAAd,CACAC,CAAC,CAACC,mBAAF,CAAsBC,OAAtB,CAA8BC,UAA9B,CAAyCL,CAAzC,CAAkD,MAAlD,CAEH,CACJ,CATL,CAUH,CA5CQ,CAgDhB,CAzDC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package   mod_bigbluebuttonbn\n * @copyright 2020 onwards, Blindside Networks Inc\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  (david.pesce [at] exputo [dt] com)\n\n * @module mod_bigbluebuttonbn/broker\n*/\n\ndefine(['jquery', 'core/config', 'core/str', 'mod_bigbluebuttonbn/rooms'],\n    function ($, mdlcfg, str, rooms) {\n\n        /**\n         * Declare variables.\n         */\n        var datasource = null;\n        var bigbluebuttonbn = {};\n\n        var Broker = {\n            /**\n             * Initialise the broker code.\n             * @method init\n             * @param {object} bigbluebuttonbn\n             */\n            init: function (bbb) {\n                datasource = mdlcfg.wwwroot + \"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey=\" + mdlcfg.sesskey + \"&\";\n                bigbluebuttonbn = bbb;\n            },\n\n            /**\n             * Open the bbb meeting URL.\n             * @param {string} joinUrl\n             */\n            joinRedirect: function (joinUrl) {\n                window.open(joinUrl);\n            },\n\n            endMeeting: function () {\n                var qs = 'action=meeting_end&id=' + bigbluebuttonbn.meetingid;\n                qs += '&bigbluebuttonbn=' + bigbluebuttonbn.bigbluebuttonbnid;\n                $.getJSON({\n                    url: datasource + qs\n                })\n                    .done(function (error) {\n                        if (error.data.status) {\n                            rooms.endMeeting();\n                            location.reload();\n                        }\n                    });\n            },\n\n            completionValidate: function (qs) {\n                $.getJSON({\n                    url: this.datasource + qs\n                })\n                    .done(function (error) {\n                        if (error.data.status) {\n                            var message = str.get_string('completionvalidatestatetriggered', 'bigbluebuttonbn');\n                            M.mod_bigbluebuttonbn.helpers.alertError(message, 'info');\n                            return;\n                        }\n                    });\n            }\n        };\n\n        return Broker;\n    });"],"file":"broker.min.js"}