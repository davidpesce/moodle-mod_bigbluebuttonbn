define ("mod_bigbluebuttonbn/recordings",["jquery","core/config","core/str","mod_bigbluebuttonbn/helpers","mod_bigbluebuttonbn/broker","core/yui"],function(a,b,c,d,e,f){var g=null,h={},i=null,j=0,k={FORM_SEARCH_RECORDINGS:"#bigbluebuttonbn_recordings_searchform",SEARCH_TEXT:"#searchtext"};return{init:function init(c){var e=this;j=c.bbbid;g=b.wwwroot+"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey="+b.sesskey+"&";var i="id="+j+"&action=recording_list_table";a.getJSON(g+i).done(function(a){console.log(a);if(!1===a.recordings_html){if("all"===a.profile_features[0]||"showrecordings"===a.profile_features[0]){a.locale;h.columns=a.data.columns;h.data=e.datatableInitFormatDates(a.data.data);e.datatableInit()}}});if(a(k.FORM_SEARCH_RECORDINGS).length){k.FORM_SEARCH_RECORDINGS.click(function(){})}var l=f.one("#bigbluebuttonbn_recordings_searchform");if(l){l.delegate("click",function(a){a.preventDefault();a.stopPropagation();var b=null;if("searchsubmit"==a.target.get("id")){b=f.one("#searchtext").get("value")}else{f.one("#searchtext").set("value","")}this.filterByText(b)},"input[type=submit]",this)}d.init()},datatableInitFormatDates:function datatableInitFormatDates(a){for(var b=0,c;b<a.length;b++){c=new Date(a[b].date);a[b].date=c.toLocaleDateString(this.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}return a},initExtraLanguage:function initExtraLanguage(a){a.Intl.add("datatable-paginator",a.config.lang,{first:M.util.get_string("view_recording_yui_first","bigbluebuttonbn"),prev:M.util.get_string("view_recording_yui_prev","bigbluebuttonbn"),next:M.util.get_string("view_recording_yui_next","bigbluebuttonbn"),last:M.util.get_string("view_recording_yui_last","bigbluebuttonbn"),goToLabel:M.util.get_string("view_recording_yui_page","bigbluebuttonbn"),goToAction:M.util.get_string("view_recording_yui_go","bigbluebuttonbn"),perPage:M.util.get_string("view_recording_yui_rows","bigbluebuttonbn"),showAll:M.util.get_string("view_recording_yui_show_all","bigbluebuttonbn")})},escapeRegex:function escapeRegex(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filterByText:function filterByText(a){if(i){i.set("data",h.data);if(a){var b=i.data,c=new RegExp("<span>.*?"+this.escapeRegex(a)+".*?</span>","i"),d=b.filter({asList:!0},function(a){var b=a.get("recording"),d=a.get("description");return b&&c.test(b)||d&&c.test(d)});i.set("data",d)}}},datatableInit:function datatableInit(){var a=h.columns,b=h.data,c=this.initExtraLanguage;f({lang:this.locale}).use("intl","datatable","datatable-sort","datatable-paginator","datatype-number",function(d){c(d);var e=new d.DataTable({width:"1195px",columns:a,data:b,rowsPerPage:10,paginatorLocation:["header","footer"]}).render("#bigbluebuttonbn_recordings_table");recordings.table=e;return e})},recordingElementPayload:function recordingElementPayload(a){var b=Y.one(a),c=b.ancestor("div");return{action:b.getAttribute("data-action"),recordingid:c.getAttribute("data-recordingid"),meetingid:c.getAttribute("data-meetingid")}},recordingAction:function recordingAction(a,b,c){var d=this.recordingElementPayload(a);for(var e in c){d[e]=c[e]}if(!b){this.recordingActionPerform(d);return}var f=new M.core.confirm({modal:!0,centered:!0,question:this.recordingConfirmationMessage(d)});f.on("complete-yes",function(){this.recordingActionPerform(d)},this)},recordingActionPerform:function recordingActionPerform(a){var b=this;d.toggleSpinningWheelOn(a);e.recordingActionPerform(a);g.sendRequest({request:"&id="+this.bbbid+"&action=recording_list_table",callback:{success:function success(a){var c=a.data;if(!1===c.recordings_html&&(-1!=c.profile_features.indexOf("all")||-1!=c.profile_features.indexOf("showrecordings"))){b.locale=c.locale;b.datatable.columns=c.data.columns;b.datatable.data=b.datatableInitFormatDates(c.data.data)}}}})},recordingPublish:function recordingPublish(a){this.recordingAction(a,!1,{source:"published",goalstate:"true"})},recordingUnpublish:function recordingUnpublish(a){this.recordingAction(a,!1,{source:"published",goalstate:"false"})},recordingProtect:function recordingProtect(a){this.recordingAction(a,!1,{source:"protected",goalstate:"true"})},recordingUnprotect:function recordingUnprotect(a){this.recordingAction(a,!1,{source:"protected",goalstate:"false"})},recordingDelete:function recordingDelete(a){var b={source:"found",goalstate:!1},c=!0;if(this.recordingIsImported(a)){c=!1;b.source="status";b.goalstate=!0;b.attempts=1}this.recordingAction(a,c,b)},recordingImport:function recordingImport(a){this.recordingAction(a,!0,{})},recordingUpdate:function recordingUpdate(a){var b=Y.one(a),c=b.ancestor("div"),d={target:c.getAttribute("data-target"),source:c.getAttribute("data-source"),goalstate:b.getAttribute("data-goalstate")};this.recordingAction(a,!1,d)},recordingEdit:function recordingEdit(a){var b=Y.one(a),c=b.ancestor("div"),d=c.one("> span");d.hide();b.hide();var e=Y.Node.create("<input type=\"text\" class=\"form-control\"></input>");e.setAttribute("id",b.getAttribute("id"));e.setAttribute("value",d.getHTML());e.setAttribute("data-value",d.getHTML());e.on("keydown",this.recordingEditKeydown);e.on("focusout",this.recordingEditOnfocusout);c.append(e);e.focus().select()},recordingEditKeydown:function recordingEditKeydown(a){var b=a.which||a.keyCode;if(13==b){this.recordingEditPerform(a.currentTarget);return}if(27==b){this.recordingEditOnfocusout(a.currentTarget)}},recordingEditOnfocusout:function recordingEditOnfocusout(a){var b=a.ancestor("div");a.hide();b.one("> span").show();b.one("> a").show()},recordingEditPerform:function recordingEditPerform(a){var b=a.ancestor("div"),c=a.get("value").trim();a.setAttribute("data-action","edit");a.setAttribute("data-goalstate",c);a.hide();this.recordingUpdate(a.getDOMNode());b.one("> span").setHTML(c).show();b.one("> a").show()},recordingEditCompletion:function recordingEditCompletion(a,b){var c=d.elementId(a.action,a.target),e=Y.one("a#"+c+"-"+a.recordingid),f=e.ancestor("div"),g=f.one("> span");if("undefined"==typeof g){return}var h=f.one("> input");if(b){g.setHTML(h.getAttribute("data-value"))}h.remove()},recordingPlay:function recordingPlay(a){var b=Y.one(a);if(""===b.getAttribute("data-href")){d.alertError(M.util.get_string("view_recording_format_errror_unreachable","bigbluebuttonbn"));return}var c={target:b.getAttribute("data-target"),source:"published",goalstate:"true",attempts:1,dataset:b.getData()};this.windowVideoPlay=window.open("","_blank");this.windowVideoPlay.opener=null;this.recordingAction(a,!1,c)},recordingConfirmationMessage:function recordingConfirmationMessage(a){var b,c,e,f,g;b=M.util.get_string("view_recording_"+a.action+"_confirmation","bigbluebuttonbn");if("undefined"==typeof b){return""}c=M.util.get_string("view_recording","bigbluebuttonbn");if("true"===Y.one("#playbacks-"+a.recordingid).get("dataset").imported){c=M.util.get_string("view_recording_link","bigbluebuttonbn")}b=b.replace("{$a}",c);if("import"===a.action){return b}e=d.elementId(a.action,a.target);f=Y.one("a#"+e+"-"+a.recordingid).get("dataset").links;if(0===f){return b}g=M.util.get_string("view_recording_"+a.action+"_confirmation_warning_p","bigbluebuttonbn");if(1==f){g=M.util.get_string("view_recording_"+a.action+"_confirmation_warning_s","bigbluebuttonbn")}g=g.replace("{$a}",f)+". ";return g+"\n\n"+b},recordingActionCompletion:function recordingActionCompletion(a){var b,c,e;if("delete"==a.action){e=Y.one("div#recording-actionbar-"+a.recordingid).ancestor("td").ancestor("tr");c=e.ancestor("tbody");if(1==c.all("tr").size()){b=Y.one("#bigbluebuttonbn_view_recordings_content");b.prepend("<span>"+M.util.get_string("view_message_norecordings","bigbluebuttonbn")+"</span>");b.one("#bigbluebuttonbn_recordings_table").remove();return}e.remove();return}if("import"==a.action){e=Y.one("div#recording-actionbar-"+a.recordingid).ancestor("td").ancestor("tr");e.remove();return}if("play"==a.action){d.toggleSpinningWheelOff(a);this.windowVideoPlay.location.href=a.dataset.href;return}d.updateData(a);d.toggleSpinningWheelOff(a);d.updateId(a);if("publish"===a.action){this.recordingPublishCompletion(a.recordingid);return}if("unpublish"===a.action){this.recordingUnpublishCompletion(a.recordingid)}},recordingActionFailover:function recordingActionFailover(a){d.alertError(a.message);d.toggleSpinningWheelOff(a);if("edit"===a.action){this.recordingEditCompletion(a,!0)}},recordingPublishCompletion:function recordingPublishCompletion(a){var b=Y.one("#playbacks-"+a);b.show();var c=Y.one("#preview-"+a);if(null===c){return}c.show();d.reloadPreview(a)},recordingUnpublishCompletion:function recordingUnpublishCompletion(a){var b=Y.one("#playbacks-"+a);b.hide();var c=Y.one("#preview-"+a);if(null===c){return}c.hide()},recordingIsImported:function recordingIsImported(a){var b=Y.one(a),c=b.ancestor("tr");return"true"===c.getAttribute("data-imported")}}});
//# sourceMappingURL=recordings.min.js.map
