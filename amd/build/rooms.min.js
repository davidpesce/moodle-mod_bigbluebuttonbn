define ("mod_bigbluebuttonbn/rooms",["jquery","core/config","core/str","core/yui","mod_bigbluebuttonbn/broker"],function(a,b,c,d,e){var f={},g=null,h=null,i={CONTROL_PANEL:"#control_panel",CONTROL_PANEL_DIV:"#control_panel_div",END_BUTTON:"#end_button",JOIN_BUTTON:"#join_button",STATUS_BAR:"#status_bar",STATUS_BAR_SPAN:"#status_bar_span"};return{init:function init(a){g=b.wwwroot+"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey="+b.sesskey+"&";f=a;h=f.ping_interval;if(0===h){h=1e4}if(-1!=f.profile_features.indexOf("all")||-1!=f.profile_features.indexOf("showroom")){this.initRoom()}this.initCompletionValidate()},initRoom:function initRoom(){var b=this;c.get_strings([{key:"view_message_conference_has_ended",component:"bigbluebuttonbn"},{key:"view_message_conference_not_started",component:"bigbluebuttonbn"}]).done(function(c){if("open"!==f.activity){a(i.STATUS_BAR).append(b.initStatusBar(c[0]));if("ended"!==f.activity){var d=[c[1],f.opening,f.closing];a(i.STATUS_BAR).append(b.initStatusBar(d))}return}b.updateRoom()})},initStatusBar:function initStatusBar(b){var c=a(document.createElement("span")).attr("id","status_bar_span");if(b.constructor!==Array){return c.text(b)}for(var d in b){if(!b.hasOwnProperty(d)){continue}var e=a(document.createElement("span")).attr("id","status_bar_span_span");e.text(b[d]);e.after("<br/>");c.add(e)}return c},updateRoom:function updateRoom(b){var c=this,d="false";if("undefined"!=typeof b&&b){d="true"}var e=f.meetingid,h=f.bigbluebuttonbnid,j="action=meeting_info&id="+e+"&bigbluebuttonbn="+h+"&updatecache="+d;a.getJSON(g+j).done(function(b){a(i.STATUS_BAR).append(c.initStatusBar(b.status.message));c.initControlPanel(b);if("undefined"!=typeof b.status.can_join){a(i.JOIN_BUTTON).append(c.initJoinButton(b.status))}if("undefined"!=typeof b.status.can_end&&b.status.can_end){a(i.END_BUTTON).append(c.initEndButton(b.status))}if(!b.status.can_join){c.waitModerator({id:e,bnid:h})}})},initControlPanel:function initControlPanel(b){var d="",e=this.msgStartedAt(b.info.startTime),f=b.info.moderatorCount,g=b.info.participantCount,h=g-f,j=" <b>"+e.hours+":"+(10>e.minutes?"0":"");j+=e.minutes+"</b>. ";var k=a(document.createElement("div")).attr("id","control_panel_div");if(b.running){c.get_strings([{key:"view_message_session_started_at",component:"bigbluebuttonbn"},{key:"view_message_moderator",component:"bigbluebuttonbn"},{key:"view_message_moderators",component:"bigbluebuttonbn"},{key:"view_message_viewer",component:"bigbluebuttonbn"},{key:"view_message_viewers",component:"bigbluebuttonbn"},{key:"view_message_session_has_users",component:"bigbluebuttonbn"},{key:"view_message_and",component:"bigbluebuttonbn"},{key:"view_message_session_no_users",component:"bigbluebuttonbn"}]).done(function(b){d+=b[0]+j;var c,e;if(1===f){c=b[1]}else{c=b[2]}if(1===h){e=b[3]}else{e=b[4]}if(1<=g){d+=b[5]+" <b>"+f+"</b> "+c;d+=" "+b[6]+" <b>"+h+"</b> "+e+"."}else{d+=b[7]}k.html(d);a(i.CONTROL_PANEL).append(k)})}},initJoinButton:function initJoinButton(b){var c=this,d=a(document.createElement("input"));d.attr("id","join_button_input");d.prop("type","button");d.prop("value",b.join_button_text);d.addClass("btn btn-primary");d.click(function(){c.join(b.join_url)});if(!b.can_join){d.prop("disabled",!0);var e=a(document.createElement("img"));e.attr("id","spinning_wheel");e.attr("src","pix/i/processing16.gif");a(i.STATUS_BAR_SPAN).after("&nbsp;",e)}return d},initEndButton:function initEndButton(b){var c=a(document.createElement("input"));c.attr("id","end_button_input");c.prop("type","button");c.prop("value",b.end_button_text);c.addClass("btn btn-secondary");if(b.can_end){c.click(function(){e.endMeeting()})}return c},msgStartedAt:function msgStartedAt(a){var b=parseInt(a,10)-parseInt(a,10)%1e3,c=new Date(b),d=c.getHours(),e=c.getMinutes();return{hours:d,minutes:e}},endMeeting:function endMeeting(){a(i.CONTROL_PANEL_DIV).remove();a(i.JOIN_BUTTON).hide();a(i.END_BUTTON).hide()},remoteUpdate:function remoteUpdate(a){var b=this;setTimeout(function(){b.cleanRoom();b.updateRoom(!0)},a)},cleanRoom:function cleanRoom(){a(i.STATUS_BAR_SPAN).remove();a(i.CONTROL_PANEL_DIV).remove();a(i.JOIN_BUTTON).empty();a(i.END_BUTTON).empty()},windowClose:function windowClose(){window.onunload=function(){opener.this.remoteUpdate(5e3)};window.close()},waitModerator:function waitModerator(b){var c=this,d=setInterval(function(){var e="action=meeting_info&id="+b.id+"&bigbluebuttonbn="+b.bnid;a.getJSON({url:g+e}).done(function(a){if(a.running){c.cleanRoom();c.updateRoom();clearInterval(d)}}).fail(function(a){b.message=a.message})},h)},join:function join(a){var b=this;e.joinRedirect(a);setTimeout(function(){b.cleanRoom();b.updateRoom(!0)},15e3)},initCompletionValidate:function initCompletionValidate(){var a=d.one("a[href*=completion_validate]");if(!a){return}var b=a.get("hash").substr(1);a.on("click",function(){e.completionValidate(b)})}}});
//# sourceMappingURL=rooms.min.js.map
