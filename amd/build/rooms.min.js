define ("mod_bigbluebuttonbn/rooms",["jquery","core/config","core/str","core/yui","mod_bigbluebuttonbn/broker"],function(a,b,c,d,e){var f=function(){};f.init=function(a){this.datasource=b.wwwroot+"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey="+b.sesskey+"&";this.bigbluebuttonbn=a;this.pinginterval=a.ping_interval;if(0===this.pinginterval){this.pinginterval=1e4}if(-1!=this.bigbluebuttonbn.profile_features.indexOf("all")||-1!=this.bigbluebuttonbn.profile_features.indexOf("showroom")){this.initRoom()}this.initCompletionValidate()};f.initRoom=function(){console.log(this.bigbluebuttonbn);if("open"!==this.bigbluebuttonbn.activity){c.get_string("view_message_conference_has_ended","bigbluebuttonbn").done(function(b){a("#status_bar").append(f.initStatusBar(b))});if("ended"!==this.bigbluebuttonbn.activity){c.get_string("view_message_conference_not_started","bigbluebuttonbn").done(function(b){var c=[b,this.bigbluebuttonbn.opening,this.bigbluebuttonbn.closing];a("#status_bar").append(f.initStatusBar(c))})}return}this.updateRoom()};f.initStatusBar=function(b){var c=a(document.createElement("span")).attr("id","status_bar_span");if(b.constructor!==Array){return c.text(b)}for(var d in b){if(!b.hasOwnProperty(d)){continue}var e=a(document.createElement("span")).attr("id","status_bar_span_span");e.text(b[d]);e.after("<br/>");c.add(e)}return c};f.updateRoom=function(b){var c="false";if("undefined"!=typeof b&&b){c="true"}var d=this.bigbluebuttonbn.meetingid,e=this.bigbluebuttonbn.bigbluebuttonbnid,g="action=meeting_info&id="+d+"&bigbluebuttonbn="+e+"&updatecache="+c;a.getJSON(this.datasource+g,function(){}).done(function(b){console.log(b);a("#status_bar").append(f.initStatusBar(b.status.message));f.initControlPanel(b);if("undefined"!=typeof b.status.can_join){a("#join_button").append(f.initJoinButton(b.status))}if("undefined"!=typeof b.status.can_end&&b.status.can_end){a("#end_button").append(f.initEndButton(b.status))}if(!b.status.can_join){this.waitModerator({id:d,bnid:e})}}).fail(function(){})};f.initControlPanel=function(b){var d="",e=f.msgStartedAt(b.info.startTime),g=b.info.moderatorCount,h=b.info.participantCount,i=h-g,j=" <b>"+e.hours+":"+(10>e.minutes?"0":"")+e.minutes+"</b>. ",k=a(document.createElement("div")).attr("id","control_panel_div");if(b.running){c.get_strings([{key:"view_message_session_started_at",component:"bigbluebuttonbn"},{key:"view_message_moderator",component:"bigbluebuttonbn"},{key:"view_message_moderators",component:"bigbluebuttonbn"},{key:"view_message_viewer",component:"bigbluebuttonbn"},{key:"view_message_viewers",component:"bigbluebuttonbn"},{key:"view_message_session_has_users",component:"bigbluebuttonbn"},{key:"view_message_and",component:"bigbluebuttonbn"},{key:"view_message_session_no_users",component:"bigbluebuttonbn"}]).done(function(b){d+=b[0]+j;var c,e;if(1===g){c=b[1]}else{c=b[2]}if(1===i){e=b[3]}else{e=b[4]}if(1<=h){d+=b[5]+" <b>"+g+"</b> "+c;d+=" "+b[6]+" <b>"+i+"</b> "+e+"."}else{d+=b[7]}k.html(d);a("#control_panel").append(k)})}};f.initJoinButton=function(b){var c=a(document.createElement("input"));c.attr("id","join_button_input");c.prop("type","button");c.prop("value",b.join_button_text);c.addClass("btn btn-primary");c.click(function(){f.join(b.join_url)});if(!b.can_join){c.prop("disabled",!0);var d=a(document.createElement("img"));d.attr("id","spinning_wheel");d.attr("src","pix/i/processing16.gif");a("#status_bar_span").after("&nbsp;",d)}return c};f.initEndButton=function(b){var c=a(document.createElement("input"));c.attr("id","end_button_input");c.prop("type","button");c.prop("value",b.end_button_text);c.addClass("btn btn-secondary");if(b.can_end){c.click(function(){e.endMeeting()})}return c};f.msgStartedAt=function(a){var b=parseInt(a,10)-parseInt(a,10)%1e3,c=new Date(b),d=c.getHours(),e=c.getMinutes();return{hours:d,minutes:e}};f.endMeeting=function(){a("#control_panel_div").remove();a("#join_button").hide();a("#end_button").hide()};f.remoteUpdate=function(a){setTimeout(function(){f.cleanRoom();f.updateRoom(!0)},a)};f.cleanRoom=function(){a("#status_bar_span").remove();a("#control_panel_div").remove();a("#join_button").empty();a("#end_button").empty()};f.windowClose=function(){window.onunload=function(){opener.Rooms.remoteUpdate(5e3)};window.close()};f.waitModerator=function(b){var c=setInterval(function(){var d="action=meeting_info&id="+b.id+"&bigbluebuttonbn="+b.bnid;a.getJSON({url:this.datasource+d}).done(function(a){if(a.running){f.cleanRoom();f.updateRoom();clearInterval(c)}}).fail(function(a){b.message=a.message})},this.pinginterval)};f.join=function(a){e.joinRedirect(a);setTimeout(function(){f.cleanRoom();f.updateRoom(!0)},15e3)};f.initCompletionValidate=function(){var a=d.one("a[href*=completion_validate]");if(!a){return}var b=a.get("hash").substr(1);a.on("click",function(){e.completionValidate(b)})};return f});
//# sourceMappingURL=rooms.min.js.map
