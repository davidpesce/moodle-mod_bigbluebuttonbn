{"version":3,"sources":["../src/rooms.js"],"names":["define","$","MDLCFG","STR","Y","BROKER","Rooms","init","bigbluebuttonbn","datasource","wwwroot","sesskey","pinginterval","ping_interval","profile_features","indexOf","initRoom","initCompletionValidate","console","log","activity","get_string","done","string","append","initStatusBar","statusBar","opening","closing","updateRoom","statusMessage","statusBarSpan","document","createElement","attr","constructor","Array","text","message","hasOwnProperty","statusBarSpanSpan","after","add","f","updatecache","id","meetingid","bnid","bigbluebuttonbnid","qs","getJSON","data","status","initControlPanel","can_join","initJoinButton","can_end","initEndButton","waitModerator","fail","controlPanelDivHtml","startedAt","msgStartedAt","info","startTime","moderatorCount","participantCount","viewerCount","startAtMsg","hours","minutes","controlPanelDiv","running","get_strings","key","component","results","msgModerators","msgViewers","html","joinButtonInput","prop","join_button_text","addClass","click","join","join_url","spinningWheel","endButtonInput","end_button_text","endMeeting","startTimestamp","parseInt","date","Date","getHours","getMinutes","remove","hide","remoteUpdate","delay","setTimeout","cleanRoom","empty","windowClose","window","onunload","opener","close","payload","pooling","setInterval","url","clearInterval","error","joinUrl","joinRedirect","node","one","get","substr","on","completionValidate"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package    mod_bigbluebuttonbn\n * @copyright 2020 onwards, Blindside Networks Inc\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  (david.pesce [at] exputo [dt] com)\n\n * @module mod_bigbluebuttonbn/rooms\n*/\n\ndefine(['jquery', 'core/config', 'core/str', 'core/yui', 'mod_bigbluebuttonbn/broker'],\n    function ($, MDLCFG, STR, Y, BROKER) {\n\n        var Rooms = function () {\n            //\n        };\n\n        Rooms.init = function (bigbluebuttonbn) {\n            this.datasource = MDLCFG.wwwroot + \"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey=\" + MDLCFG.sesskey + \"&\";\n            this.bigbluebuttonbn = bigbluebuttonbn;\n            this.pinginterval = bigbluebuttonbn.ping_interval;\n            if (this.pinginterval === 0) {\n                this.pinginterval = 10000;\n            }\n            if (this.bigbluebuttonbn.profile_features.indexOf('all') != -1 ||\n                this.bigbluebuttonbn.profile_features.indexOf('showroom') != -1) {\n                this.initRoom();\n            }\n            this.initCompletionValidate();\n        };\n\n        Rooms.initRoom = function () {\n            console.log(this.bigbluebuttonbn);\n            if (this.bigbluebuttonbn.activity !== 'open') {\n                STR.get_string('view_message_conference_has_ended', 'bigbluebuttonbn')\n                    .done(function (string) {\n                        $('#status_bar').append(Rooms.initStatusBar(string));\n                    });\n                if (this.bigbluebuttonbn.activity !== 'ended') {\n                    STR.get_string('view_message_conference_not_started', 'bigbluebuttonbn')\n                        .done(function (string) {\n                            var statusBar = [\n                                string,\n                                this.bigbluebuttonbn.opening,\n                                this.bigbluebuttonbn.closing\n                            ];\n                            $('#status_bar').append(Rooms.initStatusBar(statusBar));\n                        });\n                }\n                return;\n            }\n            this.updateRoom();\n        };\n\n        Rooms.initStatusBar = function (statusMessage) {\n            var statusBarSpan = $(document.createElement('span')).attr('id', 'status_bar_span');\n            if (statusMessage.constructor !== Array) {\n                return statusBarSpan.text(statusMessage);\n            }\n            for (var message in statusMessage) {\n                if (!statusMessage.hasOwnProperty(message)) {\n                    continue; // Skip keys from the prototype.\n                }\n                var statusBarSpanSpan = $(document.createElement('span')).attr('id', 'status_bar_span_span');\n                statusBarSpanSpan.text(statusMessage[message]);\n                statusBarSpanSpan.after('<br/>');\n                statusBarSpan.add(statusBarSpanSpan);\n            }\n            return statusBarSpan;\n        };\n\n        Rooms.updateRoom = function (f) {\n            var updatecache = 'false';\n            if (typeof f !== 'undefined' && f) {\n                updatecache = 'true';\n            }\n            var id = this.bigbluebuttonbn.meetingid;\n            var bnid = this.bigbluebuttonbn.bigbluebuttonbnid;\n            var qs = 'action=meeting_info&id=' + id + '&bigbluebuttonbn=' + bnid + '&updatecache=' + updatecache;\n            $.getJSON(this.datasource + qs, function () { })\n                .done(function (data) {\n                    console.log(data);\n                    $('#status_bar').append(Rooms.initStatusBar(data.status.message));\n                    Rooms.initControlPanel(data);\n                    if (typeof data.status.can_join != 'undefined') {\n                        $('#join_button').append(Rooms.initJoinButton(data.status));\n                    }\n                    if (typeof data.status.can_end != 'undefined' && data.status.can_end) {\n                        $('#end_button').append(Rooms.initEndButton(data.status));\n                    }\n                    if (!data.status.can_join) {\n                        this.waitModerator({\n                            id: id,\n                            bnid: bnid\n                        });\n                    }\n                })\n                .fail(function () { });\n        };\n\n        Rooms.initControlPanel = function (data) {\n            var controlPanelDivHtml = '';\n            var startedAt = Rooms.msgStartedAt(data.info.startTime);\n            var moderatorCount = data.info.moderatorCount;\n            var participantCount = data.info.participantCount;\n            var viewerCount = participantCount - moderatorCount;\n\n            var startAtMsg = ' <b>' + startedAt.hours + ':' + (startedAt.minutes < 10 ? '0' : '') + startedAt.minutes + '</b>. ';\n            var controlPanelDiv = $(document.createElement('div')).attr('id', 'control_panel_div');\n            if (data.running) {\n                var stringsToRetrieve = [\n                    {\n                        key:'view_message_session_started_at',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_moderator',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_moderators',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_viewer',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_viewers',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_session_has_users',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_and',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_session_no_users',\n                        component: 'bigbluebuttonbn'\n                    }\n                ];\n                STR.get_strings(stringsToRetrieve)\n                    .done(function(results){\n                        //Display start time message\n                        controlPanelDivHtml += results[0] + startAtMsg;\n\n                        //determine which strings to used based on participants\n                        var msgModerators, msgViewers;\n\n                        if (moderatorCount === 1){\n                            msgModerators = results[1];\n                        }\n                        else{\n                            msgModerators = results[2];\n                        }\n                        if (viewerCount === 1){\n                            msgViewers = results[3];\n                        }\n                        else{\n                            msgViewers = results[4];\n                        }\n                        if(participantCount >= 1){\n                            controlPanelDivHtml += results[5] + ' <b>' + moderatorCount + '</b> ' + msgModerators;\n                            controlPanelDivHtml += ' ' + results[6] + ' <b>' + viewerCount + '</b> ' + msgViewers + '.';\n                        }\n                        else{\n                            controlPanelDivHtml += results[7];\n                        }\n\n                        //Add messages to control panel\n                        controlPanelDiv.html(controlPanelDivHtml);\n                        $('#control_panel').append(controlPanelDiv);\n                    });\n            }\n        };\n\n        Rooms.initJoinButton = function (status) {\n            var joinButtonInput = $(document.createElement('input'));\n            joinButtonInput.attr('id', 'join_button_input');\n            joinButtonInput.prop('type', 'button');\n            joinButtonInput.prop('value', status.join_button_text);\n            joinButtonInput.addClass('btn btn-primary');\n            joinButtonInput.click(function () {\n                Rooms.join(status.join_url);\n            });\n\n            if (!status.can_join) {\n                // Disable join button.\n                joinButtonInput.prop('disabled', true);\n\n                // Create a img element.\n                var spinningWheel = $(document.createElement('img'));\n                spinningWheel.attr('id', 'spinning_wheel');\n                spinningWheel.attr('src', 'pix/i/processing16.gif');\n\n                // Add the spinning wheel.\n                $('#status_bar_span').after('&nbsp;', spinningWheel);\n            }\n            return joinButtonInput;\n        };\n\n        Rooms.initEndButton = function (status) {\n            var endButtonInput = $(document.createElement('input'));\n            endButtonInput.attr('id', 'end_button_input');\n            endButtonInput.prop('type', 'button');\n            endButtonInput.prop('value', status.end_button_text);\n            endButtonInput.addClass('btn btn-secondary');\n\n            if (status.can_end) {\n                endButtonInput.click(function () {\n                    BROKER.endMeeting();\n                });\n            }\n            return endButtonInput;\n        };\n\n        Rooms.msgStartedAt = function (startTime) {\n            var startTimestamp = (parseInt(startTime, 10) - parseInt(startTime, 10) % 1000);\n            var date = new Date(startTimestamp);\n            var hours = date.getHours();\n            var minutes = date.getMinutes();\n            return {\n                hours: hours,\n                minutes: minutes\n            };\n        };\n\n        Rooms.endMeeting = function () {\n            $('#control_panel_div').remove();\n            $('#join_button').hide();\n            $('#end_button').hide();\n        };\n\n        Rooms.remoteUpdate = function (delay) {\n            setTimeout(function () {\n                Rooms.cleanRoom();\n                Rooms.updateRoom(true);\n            }, delay);\n        };\n\n        Rooms.cleanRoom = function () {\n            $('#status_bar_span').remove();\n            $('#control_panel_div').remove();\n            $('#join_button').empty();\n            $('#end_button').empty();\n        };\n\n        Rooms.windowClose = function () {\n            window.onunload = function () {\n                opener.Rooms.remoteUpdate(5000);\n            };\n            window.close();\n        };\n\n        Rooms.waitModerator = function (payload) {\n            var pooling = setInterval(function () {\n                var qs = \"action=meeting_info&id=\" + payload.id + \"&bigbluebuttonbn=\" + payload.bnid;\n                $.getJSON({\n                    url: this.datasource + qs\n                })\n                    .done(function (data) {\n                        if (data.running) {\n                            Rooms.cleanRoom();\n                            Rooms.updateRoom();\n                            clearInterval(pooling);\n                            return;\n                        }\n                    })\n                    .fail(function (error) {\n                        payload.message = error.message;\n                    });\n            }, this.pinginterval);\n        };\n\n        Rooms.join = function (joinUrl) {\n            BROKER.joinRedirect(joinUrl);\n            // Update view.\n            setTimeout(function () {\n                Rooms.cleanRoom();\n                Rooms.updateRoom(true);\n            }, 15000);\n        };\n\n        Rooms.initCompletionValidate = function () {\n            var node = Y.one('a[href*=completion_validate]');\n            if (!node) {\n                return;\n            }\n            var qs = node.get('hash').substr(1);\n            node.on(\"click\", function () {\n                BROKER.completionValidate(qs);\n            });\n        };\n\n        return Rooms;\n    });"],"file":"rooms.min.js"}