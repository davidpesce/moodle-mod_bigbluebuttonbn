{"version":3,"sources":["../src/rooms.js"],"names":["define","$","mdlcfg","str","yui","broker","bigbluebuttonbn","datasource","pinginterval","SELECTORS","CONTROL_PANEL","CONTROL_PANEL_DIV","END_BUTTON","JOIN_BUTTON","STATUS_BAR","STATUS_BAR_SPAN","init","bbb","wwwroot","sesskey","ping_interval","profile_features","indexOf","initRoom","initCompletionValidate","self","get_strings","key","component","done","s","activity","append","initStatusBar","statusBar","opening","closing","updateRoom","statusMessage","statusBarSpan","document","createElement","attr","constructor","Array","text","message","hasOwnProperty","statusBarSpanSpan","after","add","cacheRequest","updatecache","id","meetingid","bnid","bigbluebuttonbnid","qs","getJSON","data","status","initControlPanel","can_join","initJoinButton","can_end","initEndButton","waitModerator","controlPanelDivHtml","startedAt","msgStartedAt","info","startTime","moderatorCount","participantCount","viewerCount","startAtMsg","hours","minutes","controlPanelDiv","running","results","msgModerators","msgViewers","html","joinButtonInput","prop","join_button_text","addClass","click","join","join_url","spinningWheel","endButtonInput","end_button_text","endMeeting","startTimestamp","parseInt","date","Date","getHours","getMinutes","remove","hide","remoteUpdate","delay","setTimeout","cleanRoom","empty","windowClose","window","onunload","opener","this","close","payload","pooling","setInterval","url","clearInterval","fail","error","joinUrl","joinRedirect","node","one","get","substr","on","completionValidate"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package   mod_bigbluebuttonbn\n * @copyright 2020 onwards, Blindside Networks Inc\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  (david.pesce [at] exputo [dt] com)\n\n * @module mod_bigbluebuttonbn/rooms\n*/\n\ndefine(['jquery', 'core/config', 'core/str', 'core/yui', 'mod_bigbluebuttonbn/broker'],\n    function ($, mdlcfg, str, yui, broker) {\n\n        /**\n         * Declare variables.\n         */\n        var bigbluebuttonbn = {};\n        var datasource = null;\n        var pinginterval = null;\n\n        /**\n         * jQuery selectors.\n         */\n        var SELECTORS = {\n            CONTROL_PANEL: '#control_panel',\n            CONTROL_PANEL_DIV: '#control_panel_div',\n            END_BUTTON: '#end_button',\n            JOIN_BUTTON: '#join_button',\n            STATUS_BAR: '#status_bar',\n            STATUS_BAR_SPAN: '#status_bar_span'\n        };\n\n        var Rooms = {\n\n            /**\n             * Initialization method called by php js_call_amd().\n             * @param Object bbb\n             */\n            init: function (bbb) {\n                datasource = mdlcfg.wwwroot + \"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey=\" + mdlcfg.sesskey + \"&\";\n                bigbluebuttonbn = bbb;\n                pinginterval = bigbluebuttonbn.ping_interval;\n\n                if (pinginterval === 0) {\n                    pinginterval = 10000;\n                }\n                if (bigbluebuttonbn.profile_features.indexOf('all') != -1 ||\n                    bigbluebuttonbn.profile_features.indexOf('showroom') != -1) {\n                    this.initRoom();\n                }\n                this.initCompletionValidate();\n            },\n\n            /**\n             * Room precheck to determine room status.\n             */\n            initRoom: function () {\n                var self = this;\n                var stringsToRetrieve = [\n                    {\n                        key: 'view_message_conference_has_ended',\n                        component: 'bigbluebuttonbn'\n                    },\n                    {\n                        key: 'view_message_conference_not_started',\n                        component: 'bigbluebuttonbn'\n                    }\n                ];\n                str.get_strings(stringsToRetrieve)\n                    .done(function (s) {\n                        if (bigbluebuttonbn.activity !== 'open') {\n                            $(SELECTORS.STATUS_BAR).append(self.initStatusBar(s[0]));\n                            if (bigbluebuttonbn.activity !== 'ended') {\n                                var statusBar = [\n                                    s[1],\n                                    bigbluebuttonbn.opening,\n                                    bigbluebuttonbn.closing\n                                ];\n                                $(SELECTORS.STATUS_BAR).append(self.initStatusBar(statusBar));\n                            }\n                            return;\n                        }\n                        self.updateRoom();\n                });\n            },\n\n            /**\n             * Create the status bar.\n             * @param {string} statusMessage\n             */\n            initStatusBar: function (statusMessage) {\n                var statusBarSpan = $(document.createElement('span')).attr('id', 'status_bar_span');\n                if (statusMessage.constructor !== Array) {\n                    return statusBarSpan.text(statusMessage);\n                }\n                for (var message in statusMessage) {\n                    if (!statusMessage.hasOwnProperty(message)) {\n                        continue; // Skip keys from the prototype.\n                    }\n                    var statusBarSpanSpan = $(document.createElement('span')).attr('id', 'status_bar_span_span');\n                    statusBarSpanSpan.text(statusMessage[message]);\n                    statusBarSpanSpan.after('<br/>');\n                    statusBarSpan.add(statusBarSpanSpan);\n                }\n                return statusBarSpan;\n            },\n\n            /**\n             * Refresh the room to update room status.\n             * @param {string} cacheRequest\n             */\n            updateRoom: function (cacheRequest) {\n                var self = this;\n                var updatecache = 'false';\n                if (typeof cacheRequest !== 'undefined' && cacheRequest) {\n                    updatecache = 'true';\n                }\n                var id = bigbluebuttonbn.meetingid;\n                var bnid = bigbluebuttonbn.bigbluebuttonbnid;\n                var qs = 'action=meeting_info&id=' + id + '&bigbluebuttonbn=' + bnid + '&updatecache=' + updatecache;\n                $.getJSON(datasource + qs)\n                    .done(function (data) {\n                        $(SELECTORS.STATUS_BAR).append(self.initStatusBar(data.status.message));\n                        self.initControlPanel(data);\n                        if (typeof data.status.can_join != 'undefined') {\n                            $(SELECTORS.JOIN_BUTTON).append(self.initJoinButton(data.status));\n                        }\n                        if (typeof data.status.can_end != 'undefined' && data.status.can_end) {\n                            $(SELECTORS.END_BUTTON).append(self.initEndButton(data.status));\n                        }\n                        if (!data.status.can_join) {\n                            self.waitModerator({\n                                id: id,\n                                bnid: bnid\n                            });\n                        }\n                });\n            },\n\n            /**\n             * Create the control panel (where room stats are displayed).\n             * @param OBJECT data - returned from bbb ajax call.\n             */\n            initControlPanel: function(data){\n                var controlPanelDivHtml = '';\n                var startedAt = this.msgStartedAt(data.info.startTime);\n                var moderatorCount = data.info.moderatorCount;\n                var participantCount = data.info.participantCount;\n                var viewerCount = participantCount - moderatorCount;\n                var startAtMsg = ' <b>' + startedAt.hours + ':' + (startedAt.minutes < 10 ? '0' : '');\n                startAtMsg += startedAt.minutes + '</b>. ';\n                var controlPanelDiv = $(document.createElement('div')).attr('id', 'control_panel_div');\n                if (data.running) {\n                    var stringsToRetrieve = [\n                        {\n                            key: 'view_message_session_started_at',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_moderator',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_moderators',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_viewer',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_viewers',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_session_has_users',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_and',\n                            component: 'bigbluebuttonbn'\n                        },\n                        {\n                            key: 'view_message_session_no_users',\n                            component: 'bigbluebuttonbn'\n                        }\n                    ];\n                    str.get_strings(stringsToRetrieve)\n                        .done(function (results) {\n                            //Display start time message\n                            controlPanelDivHtml += results[0] + startAtMsg;\n\n                            //determine which strings to used based on participants\n                            var msgModerators, msgViewers;\n\n                            if (moderatorCount === 1) {\n                                msgModerators = results[1];\n                            }\n                            else {\n                                msgModerators = results[2];\n                            }\n                            if (viewerCount === 1) {\n                                msgViewers = results[3];\n                            }\n                            else {\n                                msgViewers = results[4];\n                            }\n                            if (participantCount >= 1) {\n                                controlPanelDivHtml += results[5] + ' <b>' + moderatorCount + '</b> ' + msgModerators;\n                                controlPanelDivHtml += ' ' + results[6] + ' <b>' + viewerCount + '</b> ' + msgViewers + '.';\n                            }\n                            else {\n                                controlPanelDivHtml += results[7];\n                            }\n\n                            //Add messages to control panel\n                            controlPanelDiv.html(controlPanelDivHtml);\n                            $(SELECTORS.CONTROL_PANEL).append(controlPanelDiv);\n                        });\n                }\n            },\n\n            /**\n             * Create the join button.\n             * @param status - returned from bbb ajax call.\n             */\n            initJoinButton: function (status) {\n                var self = this;\n                var joinButtonInput = $(document.createElement('input'));\n                joinButtonInput.attr('id', 'join_button_input');\n                joinButtonInput.prop('type', 'button');\n                joinButtonInput.prop('value', status.join_button_text);\n                joinButtonInput.addClass('btn btn-primary');\n                joinButtonInput.click(function () {\n                    self.join(status.join_url);\n                });\n\n                if (!status.can_join) {\n                    // Disable join button.\n                    joinButtonInput.prop('disabled', true);\n\n                    // Create a img element.\n                    var spinningWheel = $(document.createElement('img'));\n                    spinningWheel.attr('id', 'spinning_wheel');\n                    spinningWheel.attr('src', 'pix/i/processing16.gif');\n\n                    // Add the spinning wheel.\n                    $(SELECTORS.STATUS_BAR_SPAN).after('&nbsp;', spinningWheel);\n                }\n                return joinButtonInput;\n            },\n\n            /**\n             * Create End button.\n             * @param Object status - returned from bbb ajax call.\n             */\n            initEndButton: function (status) {\n                var endButtonInput = $(document.createElement('input'));\n                endButtonInput.attr('id', 'end_button_input');\n                endButtonInput.prop('type', 'button');\n                endButtonInput.prop('value', status.end_button_text);\n                endButtonInput.addClass('btn btn-secondary');\n                if (status.can_end) {\n                    endButtonInput.click(function () {\n                        broker.endMeeting();\n                    });\n                }\n                return endButtonInput;\n            },\n\n            /**\n             * Determine meeting run time.\n             * @param Timestamp startTime\n             */\n            msgStartedAt: function (startTime) {\n                var startTimestamp = (parseInt(startTime, 10) - parseInt(startTime, 10) % 1000);\n                var date = new Date(startTimestamp);\n                var hours = date.getHours();\n                var minutes = date.getMinutes();\n                return {\n                    hours: hours,\n                    minutes: minutes\n                };\n            },\n\n            /**\n             * Actions to perform at meeting end.\n             */\n            endMeeting: function () {\n                $(SELECTORS.CONTROL_PANEL_DIV).remove();\n                $(SELECTORS.JOIN_BUTTON).hide();\n                $(SELECTORS.END_BUTTON).hide();\n            },\n\n            /**\n             * Interval to update the room at.\n             * @param delay\n             */\n            remoteUpdate: function (delay) {\n                var self = this;\n                setTimeout(function () {\n                    self.cleanRoom();\n                    self.updateRoom(true);\n                }, delay);\n            },\n\n            /**\n             * Clean the room of existing items.\n             */\n            cleanRoom: function () {\n                $(SELECTORS.STATUS_BAR_SPAN).remove();\n                $(SELECTORS.CONTROL_PANEL_DIV).remove();\n                $(SELECTORS.JOIN_BUTTON).empty();\n                $(SELECTORS.END_BUTTON).empty();\n            },\n\n            /**\n             * Attempt to slow down window closing.\n             * TODO: this most likely won't work with newer browser.\n             */\n            windowClose: function () {\n                window.onunload = function () {\n                    opener.this.remoteUpdate(5000);\n                };\n                window.close();\n            },\n\n            /**\n             * In meetings where users can't join before moderator, wait for moderator.\n             * @param payload\n             */\n            waitModerator: function (payload) {\n                var self = this;\n                var pooling = setInterval(function () {\n                    var qs = \"action=meeting_info&id=\" + payload.id + \"&bigbluebuttonbn=\" + payload.bnid;\n                    $.getJSON({\n                        url: datasource + qs\n                    })\n                        .done(function (data) {\n                            if (data.running) {\n                                self.cleanRoom();\n                                self.updateRoom();\n                                clearInterval(pooling);\n                                return;\n                            }\n                        })\n                        .fail(function (error) {\n                            payload.message = error.message;\n                        });\n                }, pinginterval);\n            },\n\n            /**\n             * Join the meeting room.\n             * @param {string} joinUrl\n             */\n            join: function (joinUrl) {\n                var self = this;\n                broker.joinRedirect(joinUrl);\n                // Update view.\n                setTimeout(function () {\n                    self.cleanRoom();\n                    self.updateRoom(true);\n                }, 15000);\n            },\n\n            /**\n             * Add completion check (if enabled).\n             */\n            initCompletionValidate: function () {\n                var node = yui.one('a[href*=completion_validate]');\n                if (!node) {\n                    return;\n                }\n                var qs = node.get('hash').substr(1);\n                node.on(\"click\", function () {\n                    broker.completionValidate(qs);\n                });\n            }\n\n        };\n\n        return Rooms;\n    });"],"file":"rooms.min.js"}